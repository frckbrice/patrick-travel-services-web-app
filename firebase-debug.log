[debug] [2025-10-29T22:21:29.805Z] ----------------------------------------------------------------------
[debug] [2025-10-29T22:21:29.808Z] Command:       /Users/macbookpro/.nvm/versions/node/v22.14.0/bin/node /Users/macbookpro/.nvm/versions/node/v22.14.0/bin/firebase deploy --only database
[debug] [2025-10-29T22:21:29.809Z] CLI Version:   14.22.0
[debug] [2025-10-29T22:21:29.809Z] Platform:      darwin
[debug] [2025-10-29T22:21:29.809Z] Node Version:  v22.14.0
[debug] [2025-10-29T22:21:29.809Z] Time:          Wed Oct 29 2025 23:21:29 GMT+0100 (West Africa Standard Time)
[debug] [2025-10-29T22:21:29.809Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-10-29T22:21:29.811Z] >>> [apiv2][query] GET https://firebase-public.firebaseio.com/cli.json [none]
[debug] [2025-10-29T22:21:30.195Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2025-10-29T22:21:30.198Z] > authorizing via signed-in user (bricefrkc@gmail.com)
[debug] [2025-10-29T22:21:30.199Z] [iam] checking project patrick-travel-agency for permissions ["firebase.projects.get","firebasedatabase.instances.update"]
[debug] [2025-10-29T22:21:30.200Z] Checked if tokens are valid: false, expires at: 1761670823289
[debug] [2025-10-29T22:21:30.200Z] Checked if tokens are valid: false, expires at: 1761670823289
[debug] [2025-10-29T22:21:30.201Z] > refreshing access token with scopes: []
[debug] [2025-10-29T22:21:30.202Z] >>> [apiv2][query] POST https://www.googleapis.com/oauth2/v3/token [none]
[debug] [2025-10-29T22:21:30.203Z] >>> [apiv2][body] POST https://www.googleapis.com/oauth2/v3/token [omitted]
[debug] [2025-10-29T22:21:30.836Z] <<< [apiv2][status] GET https://firebase-public.firebaseio.com/cli.json 200
[debug] [2025-10-29T22:21:30.837Z] <<< [apiv2][body] GET https://firebase-public.firebaseio.com/cli.json {"cloudBuildErrorAfter":1594252800000,"cloudBuildWarnAfter":1590019200000,"defaultNode10After":1594252800000,"minVersion":"3.0.5","node8DeploysDisabledAfter":1613390400000,"node8RuntimeDisabledAfter":1615809600000,"node8WarnAfter":1600128000000}
[debug] [2025-10-29T22:21:30.893Z] <<< [apiv2][status] POST https://www.googleapis.com/oauth2/v3/token 200
[debug] [2025-10-29T22:21:30.893Z] <<< [apiv2][body] POST https://www.googleapis.com/oauth2/v3/token [omitted]
[debug] [2025-10-29T22:21:30.949Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/patrick-travel-agency:testIamPermissions [none]
[debug] [2025-10-29T22:21:30.949Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/patrick-travel-agency:testIamPermissions x-goog-quota-user=projects/patrick-travel-agency
[debug] [2025-10-29T22:21:30.950Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/patrick-travel-agency:testIamPermissions {"permissions":["firebase.projects.get","firebasedatabase.instances.update"]}
[debug] [2025-10-29T22:21:32.094Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/patrick-travel-agency:testIamPermissions 200
[debug] [2025-10-29T22:21:32.094Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/patrick-travel-agency:testIamPermissions {"permissions":["firebase.projects.get","firebasedatabase.instances.update"]}
[debug] [2025-10-29T22:21:32.094Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:21:32.094Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:21:32.095Z] >>> [apiv2][query] GET https://firebase.googleapis.com/v1beta1/projects/patrick-travel-agency [none]
[debug] [2025-10-29T22:21:32.884Z] <<< [apiv2][status] GET https://firebase.googleapis.com/v1beta1/projects/patrick-travel-agency 200
[debug] [2025-10-29T22:21:32.885Z] <<< [apiv2][body] GET https://firebase.googleapis.com/v1beta1/projects/patrick-travel-agency {"projectId":"patrick-travel-agency","projectNumber":"99009333671","displayName":"patrick travel agency","name":"projects/patrick-travel-agency","resources":{"hostingSite":"patrick-travel-agency","realtimeDatabaseInstance":"patrick-travel-agency-default-rtdb"},"state":"ACTIVE","etag":"1_5806afd9-c563-47c6-8f55-3b1bd0475a62"}
[info] 
[info] === Deploying to 'patrick-travel-agency'...
[info] 
[info] i  deploying database 
[info] i  database: checking rules syntax... 
[debug] [2025-10-29T22:21:32.890Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:21:32.890Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:21:32.890Z] >>> [apiv2][query] GET https://firebasedatabase.googleapis.com/v1beta/projects/patrick-travel-agency/locations/-/instances/patrick-travel-agency-default-rtdb [none]
[debug] [2025-10-29T22:21:34.258Z] <<< [apiv2][status] GET https://firebasedatabase.googleapis.com/v1beta/projects/patrick-travel-agency/locations/-/instances/patrick-travel-agency-default-rtdb 200
[debug] [2025-10-29T22:21:34.258Z] <<< [apiv2][body] GET https://firebasedatabase.googleapis.com/v1beta/projects/patrick-travel-agency/locations/-/instances/patrick-travel-agency-default-rtdb {"name":"projects/99009333671/locations/europe-west1/instances/patrick-travel-agency-default-rtdb","project":"projects/99009333671","databaseUrl":"https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app","type":"DEFAULT_DATABASE","state":"ACTIVE"}
[debug] [2025-10-29T22:21:34.263Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:21:34.263Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:21:34.264Z] >>> [apiv2][query] PUT https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app/.settings/rules.json dryRun=true
[debug] [2025-10-29T22:21:34.264Z] >>> [apiv2][body] PUT https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app/.settings/rules.json "{\n  \"rules\": {\n    \".read\": false,\n    \".write\": \"auth != null\",\n\n    \"chats\": {\n      \".read\": \"auth != null\",\n      \".write\": \"auth != null\",\n      \"$chatRoomId\": {\n        \".read\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n        \".write\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n        \"messages\": {\n          \".read\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n          \".write\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n          \"$messageId\": {\n            \".read\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n            \".write\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n            \".validate\": \"newData.hasChildren(['senderId', 'senderName', 'content', 'sentAt']) && newData.child('content').isString()\"\n          }\n        },\n        \"metadata\": {\n          \".read\": \"auth != null && (!data.exists() || data.child('participants/clientId').val() == auth.uid || data.child('participants/agentId').val() == auth.uid)\",\n          \".write\": \"auth != null && (!data.exists() || data.child('participants/clientId').val() == auth.uid || data.child('participants/agentId').val() == auth.uid)\",\n          \".validate\": \"newData.val() == null || (newData.hasChild('participants') && newData.child('participants').hasChildren(['clientId', 'clientName', 'agentId', 'agentName']))\"\n        }\n      }\n    },\n\n    \"userChats\": {\n      \"$userId\": {\n        \".read\": \"auth != null && auth.uid == $userId\",\n        \".write\": \"auth != null && auth.uid == $userId\",\n        \"$chatRoomId\": {\n          \".read\": \"auth != null && auth.uid == $userId\",\n          \".write\": \"auth != null && auth.uid == $userId\"\n        }\n      }\n    },\n\n    \"presence\": {\n      \"$userId\": {\n        \".read\": true,\n        \".write\": \"auth != null && auth.uid == $userId\",\n        \".validate\": \"newData.hasChildren(['userId', 'status', 'lastSeen'])\"\n      }\n    },\n\n    \"typing\": {\n      \"$chatRoomId\": {\n        \".read\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n        \"$userId\": {\n          \".write\": \"auth != null && auth.uid == $userId\",\n          \".validate\": \"newData.hasChildren(['userId', 'isTyping', 'timestamp'])\"\n        }\n      }\n    },\n\n    \"notifications\": {\n      \"$userId\": {\n        \".read\": \"auth != null && auth.uid == $userId\",\n        \".write\": false,\n        \".indexOn\": [\"timestamp\", \"isRead\"]\n      }\n    }\n  }\n}\n"
[debug] [2025-10-29T22:21:35.105Z] <<< [apiv2][status] PUT https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app/.settings/rules.json 200
[debug] [2025-10-29T22:21:35.105Z] <<< [apiv2][body] PUT https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app/.settings/rules.json {"status":"ok"}
[info] ✔  database: rules syntax for database patrick-travel-agency-default-rtdb is valid 
[info] i  database: releasing rules... 
[debug] [2025-10-29T22:21:35.106Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:21:35.106Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:21:35.107Z] >>> [apiv2][query] GET https://firebasedatabase.googleapis.com/v1beta/projects/patrick-travel-agency/locations/-/instances/patrick-travel-agency-default-rtdb [none]
[debug] [2025-10-29T22:21:35.529Z] <<< [apiv2][status] GET https://firebasedatabase.googleapis.com/v1beta/projects/patrick-travel-agency/locations/-/instances/patrick-travel-agency-default-rtdb 200
[debug] [2025-10-29T22:21:35.530Z] <<< [apiv2][body] GET https://firebasedatabase.googleapis.com/v1beta/projects/patrick-travel-agency/locations/-/instances/patrick-travel-agency-default-rtdb {"name":"projects/99009333671/locations/europe-west1/instances/patrick-travel-agency-default-rtdb","project":"projects/99009333671","databaseUrl":"https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app","type":"DEFAULT_DATABASE","state":"ACTIVE"}
[debug] [2025-10-29T22:21:35.530Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:21:35.531Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:21:35.531Z] >>> [apiv2][query] PUT https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app/.settings/rules.json 
[debug] [2025-10-29T22:21:35.531Z] >>> [apiv2][body] PUT https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app/.settings/rules.json "{\n  \"rules\": {\n    \".read\": false,\n    \".write\": \"auth != null\",\n\n    \"chats\": {\n      \".read\": \"auth != null\",\n      \".write\": \"auth != null\",\n      \"$chatRoomId\": {\n        \".read\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n        \".write\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n        \"messages\": {\n          \".read\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n          \".write\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n          \"$messageId\": {\n            \".read\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n            \".write\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n            \".validate\": \"newData.hasChildren(['senderId', 'senderName', 'content', 'sentAt']) && newData.child('content').isString()\"\n          }\n        },\n        \"metadata\": {\n          \".read\": \"auth != null && (!data.exists() || data.child('participants/clientId').val() == auth.uid || data.child('participants/agentId').val() == auth.uid)\",\n          \".write\": \"auth != null && (!data.exists() || data.child('participants/clientId').val() == auth.uid || data.child('participants/agentId').val() == auth.uid)\",\n          \".validate\": \"newData.val() == null || (newData.hasChild('participants') && newData.child('participants').hasChildren(['clientId', 'clientName', 'agentId', 'agentName']))\"\n        }\n      }\n    },\n\n    \"userChats\": {\n      \"$userId\": {\n        \".read\": \"auth != null && auth.uid == $userId\",\n        \".write\": \"auth != null && auth.uid == $userId\",\n        \"$chatRoomId\": {\n          \".read\": \"auth != null && auth.uid == $userId\",\n          \".write\": \"auth != null && auth.uid == $userId\"\n        }\n      }\n    },\n\n    \"presence\": {\n      \"$userId\": {\n        \".read\": true,\n        \".write\": \"auth != null && auth.uid == $userId\",\n        \".validate\": \"newData.hasChildren(['userId', 'status', 'lastSeen'])\"\n      }\n    },\n\n    \"typing\": {\n      \"$chatRoomId\": {\n        \".read\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n        \"$userId\": {\n          \".write\": \"auth != null && auth.uid == $userId\",\n          \".validate\": \"newData.hasChildren(['userId', 'isTyping', 'timestamp'])\"\n        }\n      }\n    },\n\n    \"notifications\": {\n      \"$userId\": {\n        \".read\": \"auth != null && auth.uid == $userId\",\n        \".write\": false,\n        \".indexOn\": [\"timestamp\", \"isRead\"]\n      }\n    }\n  }\n}\n"
[debug] [2025-10-29T22:21:35.982Z] <<< [apiv2][status] PUT https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app/.settings/rules.json 200
[debug] [2025-10-29T22:27:42.126Z] ----------------------------------------------------------------------
[debug] [2025-10-29T22:27:42.130Z] Command:       /Users/macbookpro/.nvm/versions/node/v22.14.0/bin/node /Users/macbookpro/.nvm/versions/node/v22.14.0/bin/firebase deploy --only database
[debug] [2025-10-29T22:27:42.130Z] CLI Version:   14.22.0
[debug] [2025-10-29T22:27:42.130Z] Platform:      darwin
[debug] [2025-10-29T22:27:42.131Z] Node Version:  v22.14.0
[debug] [2025-10-29T22:27:42.131Z] Time:          Wed Oct 29 2025 23:27:42 GMT+0100 (West Africa Standard Time)
[debug] [2025-10-29T22:27:42.131Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-10-29T22:27:42.383Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2025-10-29T22:27:42.384Z] > authorizing via signed-in user (bricefrkc@gmail.com)
[debug] [2025-10-29T22:27:42.385Z] [iam] checking project patrick-travel-agency for permissions ["firebase.projects.get","firebasedatabase.instances.update"]
[debug] [2025-10-29T22:27:42.386Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:27:42.387Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:27:42.390Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/patrick-travel-agency:testIamPermissions [none]
[debug] [2025-10-29T22:27:42.390Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/patrick-travel-agency:testIamPermissions x-goog-quota-user=projects/patrick-travel-agency
[debug] [2025-10-29T22:27:42.390Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/patrick-travel-agency:testIamPermissions {"permissions":["firebase.projects.get","firebasedatabase.instances.update"]}
[debug] [2025-10-29T22:27:43.492Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/patrick-travel-agency:testIamPermissions 200
[debug] [2025-10-29T22:27:43.493Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/patrick-travel-agency:testIamPermissions {"permissions":["firebase.projects.get","firebasedatabase.instances.update"]}
[debug] [2025-10-29T22:27:43.494Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:27:43.494Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:27:43.494Z] >>> [apiv2][query] GET https://firebase.googleapis.com/v1beta1/projects/patrick-travel-agency [none]
[debug] [2025-10-29T22:27:44.163Z] <<< [apiv2][status] GET https://firebase.googleapis.com/v1beta1/projects/patrick-travel-agency 200
[debug] [2025-10-29T22:27:44.164Z] <<< [apiv2][body] GET https://firebase.googleapis.com/v1beta1/projects/patrick-travel-agency {"projectId":"patrick-travel-agency","projectNumber":"99009333671","displayName":"patrick travel agency","name":"projects/patrick-travel-agency","resources":{"hostingSite":"patrick-travel-agency","realtimeDatabaseInstance":"patrick-travel-agency-default-rtdb"},"state":"ACTIVE","etag":"1_5806afd9-c563-47c6-8f55-3b1bd0475a62"}
[info] 
[info] === Deploying to 'patrick-travel-agency'...
[info] 
[info] i  deploying database 
[info] i  database: checking rules syntax... 
[debug] [2025-10-29T22:27:44.171Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:27:44.172Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:27:44.173Z] >>> [apiv2][query] GET https://firebasedatabase.googleapis.com/v1beta/projects/patrick-travel-agency/locations/-/instances/patrick-travel-agency-default-rtdb [none]
[debug] [2025-10-29T22:27:45.279Z] <<< [apiv2][status] GET https://firebasedatabase.googleapis.com/v1beta/projects/patrick-travel-agency/locations/-/instances/patrick-travel-agency-default-rtdb 200
[debug] [2025-10-29T22:27:45.279Z] <<< [apiv2][body] GET https://firebasedatabase.googleapis.com/v1beta/projects/patrick-travel-agency/locations/-/instances/patrick-travel-agency-default-rtdb {"name":"projects/99009333671/locations/europe-west1/instances/patrick-travel-agency-default-rtdb","project":"projects/99009333671","databaseUrl":"https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app","type":"DEFAULT_DATABASE","state":"ACTIVE"}
[debug] [2025-10-29T22:27:45.280Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:27:45.281Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:27:45.281Z] >>> [apiv2][query] PUT https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app/.settings/rules.json dryRun=true
[debug] [2025-10-29T22:27:45.281Z] >>> [apiv2][body] PUT https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app/.settings/rules.json "{\n  \"rules\": {\n    \".read\": false,\n    \".write\": \"auth != null\",\n\n    \"chats\": {\n      \".read\": \"auth != null\",\n      \".write\": \"auth != null\",\n      \"$chatRoomId\": {\n        \".read\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n        \".write\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n        \"messages\": {\n          \"$messageId\": {\n            \".read\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n            \".write\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n            \".validate\": \"newData.hasChildren(['senderId', 'senderName', 'content', 'sentAt']) && newData.child('content').isString()\"\n          }\n        },\n        \"metadata\": {\n          \".read\": \"auth != null && (!data.exists() || data.child('participants/clientId').val() == auth.uid || data.child('participants/agentId').val() == auth.uid)\",\n          \".write\": \"auth != null && (!data.exists() || data.child('participants/clientId').val() == auth.uid || data.child('participants/agentId').val() == auth.uid)\",\n          \".validate\": \"newData.val() == null || (data.exists() && data.child('participants').exists()) || (newData.hasChild('participants') && newData.child('participants').hasChildren(['clientId', 'clientName', 'agentId', 'agentName']))\"\n        }\n      }\n    },\n\n    \"userChats\": {\n      \"$userId\": {\n        \".read\": \"auth != null && auth.uid == $userId\",\n        \".write\": \"auth != null && auth.uid == $userId\",\n        \"$chatRoomId\": {\n          \".read\": \"auth != null && auth.uid == $userId\",\n          \".write\": \"auth != null && auth.uid == $userId\"\n        }\n      }\n    },\n\n    \"presence\": {\n      \"$userId\": {\n        \".read\": true,\n        \".write\": \"auth != null && auth.uid == $userId\",\n        \".validate\": \"newData.hasChildren(['userId', 'status', 'lastSeen'])\"\n      }\n    },\n\n    \"typing\": {\n      \"$chatRoomId\": {\n        \".read\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n        \"$userId\": {\n          \".write\": \"auth != null && auth.uid == $userId\",\n          \".validate\": \"newData.hasChildren(['userId', 'isTyping', 'timestamp'])\"\n        }\n      }\n    },\n\n    \"notifications\": {\n      \"$userId\": {\n        \".read\": \"auth != null && auth.uid == $userId\",\n        \".write\": false,\n        \".indexOn\": [\"timestamp\", \"isRead\"]\n      }\n    }\n  }\n}\n"
[debug] [2025-10-29T22:27:45.824Z] <<< [apiv2][status] PUT https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app/.settings/rules.json 200
[debug] [2025-10-29T22:27:45.825Z] <<< [apiv2][body] PUT https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app/.settings/rules.json {"status":"ok"}
[info] ✔  database: rules syntax for database patrick-travel-agency-default-rtdb is valid 
[info] i  database: releasing rules... 
[debug] [2025-10-29T22:27:45.826Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:27:45.827Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:27:45.827Z] >>> [apiv2][query] GET https://firebasedatabase.googleapis.com/v1beta/projects/patrick-travel-agency/locations/-/instances/patrick-travel-agency-default-rtdb [none]
[debug] [2025-10-29T22:27:46.175Z] <<< [apiv2][status] GET https://firebasedatabase.googleapis.com/v1beta/projects/patrick-travel-agency/locations/-/instances/patrick-travel-agency-default-rtdb 200
[debug] [2025-10-29T22:27:46.176Z] <<< [apiv2][body] GET https://firebasedatabase.googleapis.com/v1beta/projects/patrick-travel-agency/locations/-/instances/patrick-travel-agency-default-rtdb {"name":"projects/99009333671/locations/europe-west1/instances/patrick-travel-agency-default-rtdb","project":"projects/99009333671","databaseUrl":"https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app","type":"DEFAULT_DATABASE","state":"ACTIVE"}
[debug] [2025-10-29T22:27:46.176Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:27:46.176Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:27:46.177Z] >>> [apiv2][query] PUT https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app/.settings/rules.json 
[debug] [2025-10-29T22:27:46.177Z] >>> [apiv2][body] PUT https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app/.settings/rules.json "{\n  \"rules\": {\n    \".read\": false,\n    \".write\": \"auth != null\",\n\n    \"chats\": {\n      \".read\": \"auth != null\",\n      \".write\": \"auth != null\",\n      \"$chatRoomId\": {\n        \".read\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n        \".write\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n        \"messages\": {\n          \"$messageId\": {\n            \".read\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n            \".write\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n            \".validate\": \"newData.hasChildren(['senderId', 'senderName', 'content', 'sentAt']) && newData.child('content').isString()\"\n          }\n        },\n        \"metadata\": {\n          \".read\": \"auth != null && (!data.exists() || data.child('participants/clientId').val() == auth.uid || data.child('participants/agentId').val() == auth.uid)\",\n          \".write\": \"auth != null && (!data.exists() || data.child('participants/clientId').val() == auth.uid || data.child('participants/agentId').val() == auth.uid)\",\n          \".validate\": \"newData.val() == null || (data.exists() && data.child('participants').exists()) || (newData.hasChild('participants') && newData.child('participants').hasChildren(['clientId', 'clientName', 'agentId', 'agentName']))\"\n        }\n      }\n    },\n\n    \"userChats\": {\n      \"$userId\": {\n        \".read\": \"auth != null && auth.uid == $userId\",\n        \".write\": \"auth != null && auth.uid == $userId\",\n        \"$chatRoomId\": {\n          \".read\": \"auth != null && auth.uid == $userId\",\n          \".write\": \"auth != null && auth.uid == $userId\"\n        }\n      }\n    },\n\n    \"presence\": {\n      \"$userId\": {\n        \".read\": true,\n        \".write\": \"auth != null && auth.uid == $userId\",\n        \".validate\": \"newData.hasChildren(['userId', 'status', 'lastSeen'])\"\n      }\n    },\n\n    \"typing\": {\n      \"$chatRoomId\": {\n        \".read\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n        \"$userId\": {\n          \".write\": \"auth != null && auth.uid == $userId\",\n          \".validate\": \"newData.hasChildren(['userId', 'isTyping', 'timestamp'])\"\n        }\n      }\n    },\n\n    \"notifications\": {\n      \"$userId\": {\n        \".read\": \"auth != null && auth.uid == $userId\",\n        \".write\": false,\n        \".indexOn\": [\"timestamp\", \"isRead\"]\n      }\n    }\n  }\n}\n"
[debug] [2025-10-29T22:27:46.580Z] <<< [apiv2][status] PUT https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app/.settings/rules.json 200
[debug] [2025-10-29T22:28:53.278Z] ----------------------------------------------------------------------
[debug] [2025-10-29T22:28:53.284Z] Command:       /Users/macbookpro/.nvm/versions/node/v22.14.0/bin/node /Users/macbookpro/.nvm/versions/node/v22.14.0/bin/firebase deploy --only database
[debug] [2025-10-29T22:28:53.285Z] CLI Version:   14.22.0
[debug] [2025-10-29T22:28:53.285Z] Platform:      darwin
[debug] [2025-10-29T22:28:53.285Z] Node Version:  v22.14.0
[debug] [2025-10-29T22:28:53.286Z] Time:          Wed Oct 29 2025 23:28:53 GMT+0100 (West Africa Standard Time)
[debug] [2025-10-29T22:28:53.286Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-10-29T22:28:53.864Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2025-10-29T22:28:53.866Z] > authorizing via signed-in user (bricefrkc@gmail.com)
[debug] [2025-10-29T22:28:53.867Z] [iam] checking project patrick-travel-agency for permissions ["firebase.projects.get","firebasedatabase.instances.update"]
[debug] [2025-10-29T22:28:53.870Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:28:53.870Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:28:53.872Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/patrick-travel-agency:testIamPermissions [none]
[debug] [2025-10-29T22:28:53.875Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/patrick-travel-agency:testIamPermissions x-goog-quota-user=projects/patrick-travel-agency
[debug] [2025-10-29T22:28:53.876Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/patrick-travel-agency:testIamPermissions {"permissions":["firebase.projects.get","firebasedatabase.instances.update"]}
[debug] [2025-10-29T22:28:55.012Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/patrick-travel-agency:testIamPermissions 200
[debug] [2025-10-29T22:28:55.014Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/patrick-travel-agency:testIamPermissions {"permissions":["firebase.projects.get","firebasedatabase.instances.update"]}
[debug] [2025-10-29T22:28:55.015Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:28:55.015Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:28:55.016Z] >>> [apiv2][query] GET https://firebase.googleapis.com/v1beta1/projects/patrick-travel-agency [none]
[debug] [2025-10-29T22:28:55.668Z] <<< [apiv2][status] GET https://firebase.googleapis.com/v1beta1/projects/patrick-travel-agency 200
[debug] [2025-10-29T22:28:55.668Z] <<< [apiv2][body] GET https://firebase.googleapis.com/v1beta1/projects/patrick-travel-agency {"projectId":"patrick-travel-agency","projectNumber":"99009333671","displayName":"patrick travel agency","name":"projects/patrick-travel-agency","resources":{"hostingSite":"patrick-travel-agency","realtimeDatabaseInstance":"patrick-travel-agency-default-rtdb"},"state":"ACTIVE","etag":"1_5806afd9-c563-47c6-8f55-3b1bd0475a62"}
[info] 
[info] === Deploying to 'patrick-travel-agency'...
[info] 
[info] i  deploying database 
[info] i  database: checking rules syntax... 
[debug] [2025-10-29T22:28:55.673Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:28:55.673Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:28:55.673Z] >>> [apiv2][query] GET https://firebasedatabase.googleapis.com/v1beta/projects/patrick-travel-agency/locations/-/instances/patrick-travel-agency-default-rtdb [none]
[debug] [2025-10-29T22:28:56.787Z] <<< [apiv2][status] GET https://firebasedatabase.googleapis.com/v1beta/projects/patrick-travel-agency/locations/-/instances/patrick-travel-agency-default-rtdb 200
[debug] [2025-10-29T22:28:56.787Z] <<< [apiv2][body] GET https://firebasedatabase.googleapis.com/v1beta/projects/patrick-travel-agency/locations/-/instances/patrick-travel-agency-default-rtdb {"name":"projects/99009333671/locations/europe-west1/instances/patrick-travel-agency-default-rtdb","project":"projects/99009333671","databaseUrl":"https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app","type":"DEFAULT_DATABASE","state":"ACTIVE"}
[debug] [2025-10-29T22:28:56.790Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:28:56.790Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:28:56.791Z] >>> [apiv2][query] PUT https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app/.settings/rules.json dryRun=true
[debug] [2025-10-29T22:28:56.791Z] >>> [apiv2][body] PUT https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app/.settings/rules.json "{\n  \"rules\": {\n    \".read\": false,\n    \".write\": \"auth != null\",\n\n    \"chats\": {\n      \".read\": \"auth != null\",\n      \".write\": \"auth != null\",\n\n      \"$chatRoomId\": {\n        \".read\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n        \".write\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n\n        \"messages\": {\n          \"$messageId\": {\n            \".read\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n            \".write\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n            \".validate\": \"newData.hasChildren(['senderId', 'senderName', 'content', 'sentAt']) && newData.child('content').isString()\"\n          }\n        },\n\n        \"metadata\": {\n          \".read\": \"auth != null && (!data.exists() || data.child('participants/clientId').val() == auth.uid || data.child('participants/agentId').val() == auth.uid)\",\n          \".write\": \"auth != null && (!data.exists() || data.child('participants/clientId').val() == auth.uid || data.child('participants/agentId').val() == auth.uid)\",\n          \".validate\": \"newData.val() == null || ((data.exists() && data.child('participants').exists() && (data.child('participants/clientId').val() == auth.uid || data.child('participants/agentId').val() == auth.uid)) || (newData.hasChild('participants') && newData.child('participants').hasChildren(['clientId', 'clientName', 'agentId', 'agentName']) && (newData.child('participants/clientId').val() == auth.uid || newData.child('participants/agentId').val() == auth.uid)))\"\n        }\n      }\n    },\n\n    \"userChats\": {\n      \"$userId\": {\n        \".read\": \"auth != null && auth.uid == $userId\",\n        \".write\": \"auth != null && auth.uid == $userId\",\n        \"$chatRoomId\": {\n          \".read\": \"auth != null && auth.uid == $userId\",\n          \".write\": \"auth != null && auth.uid == $userId\"\n        }\n      }\n    },\n\n    \"presence\": {\n      \"$userId\": {\n        \".read\": true,\n        \".write\": \"auth != null && auth.uid == $userId\",\n        \".validate\": \"newData.hasChildren(['userId', 'status', 'lastSeen'])\"\n      }\n    },\n\n    \"typing\": {\n      \"$chatRoomId\": {\n        \".read\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n        \"$userId\": {\n          \".write\": \"auth != null && auth.uid == $userId\",\n          \".validate\": \"newData.hasChildren(['userId', 'isTyping', 'timestamp'])\"\n        }\n      }\n    },\n\n    \"notifications\": {\n      \"$userId\": {\n        \".read\": \"auth != null && auth.uid == $userId\",\n        \".write\": false,\n        \".indexOn\": [\"timestamp\", \"isRead\"]\n      }\n    }\n  }\n}\n"
[debug] [2025-10-29T22:28:57.268Z] <<< [apiv2][status] PUT https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app/.settings/rules.json 200
[debug] [2025-10-29T22:28:57.269Z] <<< [apiv2][body] PUT https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app/.settings/rules.json {"status":"ok"}
[info] ✔  database: rules syntax for database patrick-travel-agency-default-rtdb is valid 
[info] i  database: releasing rules... 
[debug] [2025-10-29T22:28:57.272Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:28:57.273Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:28:57.274Z] >>> [apiv2][query] GET https://firebasedatabase.googleapis.com/v1beta/projects/patrick-travel-agency/locations/-/instances/patrick-travel-agency-default-rtdb [none]
[debug] [2025-10-29T22:28:57.608Z] <<< [apiv2][status] GET https://firebasedatabase.googleapis.com/v1beta/projects/patrick-travel-agency/locations/-/instances/patrick-travel-agency-default-rtdb 200
[debug] [2025-10-29T22:28:57.609Z] <<< [apiv2][body] GET https://firebasedatabase.googleapis.com/v1beta/projects/patrick-travel-agency/locations/-/instances/patrick-travel-agency-default-rtdb {"name":"projects/99009333671/locations/europe-west1/instances/patrick-travel-agency-default-rtdb","project":"projects/99009333671","databaseUrl":"https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app","type":"DEFAULT_DATABASE","state":"ACTIVE"}
[debug] [2025-10-29T22:28:57.610Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:28:57.610Z] Checked if tokens are valid: true, expires at: 1761780089893
[debug] [2025-10-29T22:28:57.610Z] >>> [apiv2][query] PUT https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app/.settings/rules.json 
[debug] [2025-10-29T22:28:57.611Z] >>> [apiv2][body] PUT https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app/.settings/rules.json "{\n  \"rules\": {\n    \".read\": false,\n    \".write\": \"auth != null\",\n\n    \"chats\": {\n      \".read\": \"auth != null\",\n      \".write\": \"auth != null\",\n\n      \"$chatRoomId\": {\n        \".read\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n        \".write\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n\n        \"messages\": {\n          \"$messageId\": {\n            \".read\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n            \".write\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n            \".validate\": \"newData.hasChildren(['senderId', 'senderName', 'content', 'sentAt']) && newData.child('content').isString()\"\n          }\n        },\n\n        \"metadata\": {\n          \".read\": \"auth != null && (!data.exists() || data.child('participants/clientId').val() == auth.uid || data.child('participants/agentId').val() == auth.uid)\",\n          \".write\": \"auth != null && (!data.exists() || data.child('participants/clientId').val() == auth.uid || data.child('participants/agentId').val() == auth.uid)\",\n          \".validate\": \"newData.val() == null || ((data.exists() && data.child('participants').exists() && (data.child('participants/clientId').val() == auth.uid || data.child('participants/agentId').val() == auth.uid)) || (newData.hasChild('participants') && newData.child('participants').hasChildren(['clientId', 'clientName', 'agentId', 'agentName']) && (newData.child('participants/clientId').val() == auth.uid || newData.child('participants/agentId').val() == auth.uid)))\"\n        }\n      }\n    },\n\n    \"userChats\": {\n      \"$userId\": {\n        \".read\": \"auth != null && auth.uid == $userId\",\n        \".write\": \"auth != null && auth.uid == $userId\",\n        \"$chatRoomId\": {\n          \".read\": \"auth != null && auth.uid == $userId\",\n          \".write\": \"auth != null && auth.uid == $userId\"\n        }\n      }\n    },\n\n    \"presence\": {\n      \"$userId\": {\n        \".read\": true,\n        \".write\": \"auth != null && auth.uid == $userId\",\n        \".validate\": \"newData.hasChildren(['userId', 'status', 'lastSeen'])\"\n      }\n    },\n\n    \"typing\": {\n      \"$chatRoomId\": {\n        \".read\": \"auth != null && (root.child('chats/' + $chatRoomId + '/metadata/participants/clientId').val() == auth.uid || root.child('chats/' + $chatRoomId + '/metadata/participants/agentId').val() == auth.uid)\",\n        \"$userId\": {\n          \".write\": \"auth != null && auth.uid == $userId\",\n          \".validate\": \"newData.hasChildren(['userId', 'isTyping', 'timestamp'])\"\n        }\n      }\n    },\n\n    \"notifications\": {\n      \"$userId\": {\n        \".read\": \"auth != null && auth.uid == $userId\",\n        \".write\": false,\n        \".indexOn\": [\"timestamp\", \"isRead\"]\n      }\n    }\n  }\n}\n"
[debug] [2025-10-29T22:28:58.046Z] <<< [apiv2][status] PUT https://patrick-travel-agency-default-rtdb.europe-west1.firebasedatabase.app/.settings/rules.json 200
